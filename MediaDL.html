<!DOCTYPE html><html><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<meta name="format-detection" content="telephone=no,date=no">
<title>MediaDL 1.0</title>
<style>
body {
	font-family: system-ui;
	font-size: 0.95em;
	margin-top: 1rem;
	margin-bottom: calc(1rem + env(safe-area-inset-bottom));
	word-break: break-word;
}

button {
	color: #000;
	background-color: #e4e4ff;
	width: 100%;
	font-size: 1em;
	font-weight: normal;
	line-height: 1.8;
	text-align: left;
	margin: 4px 0;
	padding: 1px 8px;
	border: 1px #aaa;
	border-style: solid;
	border-radius: 8px;
	cursor: initial;
	touch-action: manipulation;
}

.button {
	margin-bottom: 0;
	border-bottom-style: none;
	border-bottom-left-radius: 0;
	border-bottom-right-radius: 0;
	cursor: auto;
}
.button::after {
	content: '\25A1';
	float: right;
	font-weight: bold;
	margin-left: 10px;
}

.closed {
	margin-bottom: 4px;
	border-bottom-style: solid;
	border-bottom-left-radius: 8px;
	border-bottom-right-radius: 8px;
}
.closed::after { content: '\2212'; }

.nonbottom {
	margin-bottom: 0;
	border-bottom-left-radius: 0;
	border-bottom-right-radius: 0;
	border-bottom-style: none;
}
.nontop {
	margin-top: 0;
	border-top-left-radius: 0;
	border-top-right-radius: 0;
}

.gGray { background-color: #e0e0e0; }
.gGreen { background-color: #ddffdd; }
.gYellow { background-color: #ffeebb; }
.gOrange { background-color: #ffddcc; }
.gRed { background-color: #ffccdd; }
.gBlue { background-color: #aaccff; }
.gUnknown { background-color: #bbffff; }
.gParams {
	text-align: center;
	background-color: #f8f8f8;
}

.content {
	overflow: hidden;
	margin-bottom: 4px;
	padding: 3px 0 3px 8px;
	border: 1px #aaa;
	border-style: none solid solid solid;
	border-bottom-left-radius: 8px;
	border-bottom-right-radius: 8px;
}

.contentloop {
	margin-bottom: 0;
	padding-top: 4px;
	padding-bottom: 4px;
	border-bottom-style: none;
	border-bottom-left-radius: 0;
	border-bottom-right-radius: 0;
}

.dashed { border-left-style: dashed; }

.inside {
	border-right-style: none;
	border-top-right-radius: 0;
	border-bottom-right-radius: 0;
}

.commentcontent { background-color: #ffeebb; }

.row {
	display: flex;
	padding-right: 2px;
}

.col1 {
	margin-right: 3px;
	padding-right: 3px;
	border-right-style: double;
}
.col2 { white-space: pre-wrap; }

span.box {
	display: inline;
	white-space: pre-wrap;
	margin: 0 2px;
	padding: 2px 4px;
	border-radius: 6px;
	background-color: #fff;
}
span.var { font-style: italic; }
span.magic {
	cursor: pointer;
	font-style: italic;
	text-decoration: underline;
}

hr {
	width: 0px;
	height: 2px;
	border: 1px solid #aaa;
	margin: -4px auto;
}

@media (prefers-color-scheme: dark) {
	body { background: #000; color: #eee; }
	button { background: #514c72; color: #eee; }
	.gGray { background-color: #555555; }
	.gGreen { background-color: #3a6441; }
	.gYellow { background-color: #716d33; }
	.gOrange { background-color: #76523f; }
	.gRed { background-color: #674044; }
	.gBlue { background-color: #384c67; }
	.gUnknown { background-color: #377172; }
	.gParams { background-color: #181818; }
	.commentcontent { background-color: #716d33; }
	span.box { background-color: #000; }
}
</style></head><body>
<button class="button gParams"><b>MediaDL 1.0</b> (<span class="magic" onclick="magictap(122)">123</span> actions, 83 KB)</button>
<div class="content"><div class="col2">"WFQuickActionSurfaces": [],
"WFWorkflowClientVersion": "2302.0.5",
"WFWorkflowHasOutputFallback": false,
"WFWorkflowHasShortcutInputVariables": true,
"WFWorkflowIcon": {
   "WFWorkflowIconStartColor": 946986751,
   "WFWorkflowIconGlyphNumber": 59693
},
"WFWorkflowImportQuestions": [],
"WFWorkflowInputContentItemClasses": [
   "WFURLContentItem"
],
"WFWorkflowMinimumClientVersion": 1113,
"WFWorkflowMinimumClientVersionString": "1113",
"WFWorkflowNoInputBehavior": {
   "Name": "WFWorkflowNoInputBehaviorGetClipboard",
   "Parameters": {}
},
"WFWorkflowOutputContentItemClasses": [],
"WFWorkflowTypes": [
   "ActionExtension"
]
</div></div>

<button class="button gYellow" id="m0">
0 Comment</button>
	<div class="content commentcontent">
		<div class="col2">MediaDL by Paul Ebose

v1.0

LATEST CHANGES

- Add support for Instagram stories and posts

https://github.com/plbstl/MediaDL</div></div>
<button class="button gYellow" id="m1">
1 Comment</button>
	<div class="content commentcontent">
		<div class="col2">“Get value from Dictionary” action is used when we want to assert the value type (eg. boolean, number) so it can be used in an “if” action.

We cannot do that directly from other actions to “if” action. It has to be piped through.

For example, we get JSON with the “Get Contents from URL” action, we can use it as a Dictionary with other actions. But we cannot use a field from the JSON to do comparisons, we need to assert the value first.</div></div>
<button class="button gYellow" id="m2">
2 Comment</button>
	<div class="content commentcontent">
		<div class="col2">Now let’s start.</div></div>
<button class="button gYellow" id="m3">
3 Comment</button>
	<div class="content commentcontent">
		<div class="col2">Make sure that the inputted url to this Shortcut is for a platform that is currently supported.

Currently, only Instagram is supported.</div></div>
<button class="gYellow" data-uuid="A8ACF891-7750-4309-89FD-A608B6189CD5" id="m4">
4 Match Text <span class="box">https://(www.)?instagram.com/(p|stories/[0-9a-zA-Z\._]*|reel|tv)/[0-9a-zA-Z\-_]*</span> in <span class="box"><span class="var"><b>[Shortcut Input]</b></span></span> <b>　➔ Valid Url</b>　»</button>
<hr><button class="button gGray nonbottom" data-uuid="07B55101-B86C-4EC1-A99D-D85031F59CBA" id="m5">
5 If <span class="box"><span class="var"><b>[4 Valid Url]</b></span></span> <span class="box">does not have any value</span></button>
	<div class="content contentloop">
		<div class="row"><div class="col1">ConditionalActionString</div>
			<div class="col2">URL</div></div>
<button class="button gYellow inside" id="m6">
6 Show Alert <span class="box">Supports only Instagram stories and posts</span></button>
	<div class="content inside">
		<div class="row"><div class="col1">AlertActionCancelButtonShown</div>
			<div class="col2">false</div></div>
		<div class="row"><div class="col1">AlertActionTitle</div>
			<div class="col2"></div></div></div>
<button class="gGray inside" id="m7">
7 Stop This Shortcut</button></div>
<button class="gGray nontop" data-uuid="B88C8DA3-315B-4979-8AD9-AEDA25ACE2D1" id="m8">
8 End If</button>
<button class="button gYellow" id="m9">
9 Comment</button>
	<div class="content commentcontent">
		<div class="col2">These variables are set here because they are used in the global scope and/or used in multiple local scopes.

At the same time, I don’t think Shortcuts uses scopes. Still, it can help understand the workings better.

If we declare a variable in a nested action, we can use it everywhere after its declaration regardless of the scope, kinda like the “var” keyword in Javascript.</div></div>
<button class="gOrange" id="m10">
10 Set Variable <span class="box">Username of Post Author</span> to <span class="box"></span>&nbsp;</button>
<button class="gOrange" id="m11">
11 Set Variable <span class="box">Download Urls</span> to <span class="box"></span>&nbsp;</button>
<button class="gOrange" id="m12">
12 Set Variable <span class="box">Platform</span> to <span class="box"></span>&nbsp;</button>
<button class="button gYellow" id="m13">
13 Comment</button>
	<div class="content commentcontent">
		<div class="col2">Check which platform is in use and act accordingly to retrieve URLs to the raw files, so they can be downloaded and saved to Photos.

Checking the platforms is tricky, because there isn’t an “else if” or “switch” action.

But…

If Instagram
    …
If Twitter
    …
If YouTube
    …</div></div>
<button class="button gGray nonbottom" data-uuid="648AEAB1-ECD6-484D-8D86-12330AD70E5F" id="m14">
14 If <span class="box"><span class="var"><b>[Shortcut Input]</b></span></span> <span class="box">contains</span> <span class="box">instagram.com/</span></button>
	<div class="content contentloop">
<button class="button gYellow inside" data-uuid="2527C90C-4625-430D-B474-BE07CA769B00" id="m15">
15 Text <b>　➔ Instagram</b>　»</button>
	<div class="content inside">
		<div class="col2">Instagram</div></div>
<hr><button class="gOrange inside" id="m16">
16 Set Variable <span class="box">Platform</span> to <span class="box"><span class="var"><b>[15 Instagram]</b></span></span></button>
<button class="button gYellow inside" id="m17">
17 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Retrieve cookies and logged in status from Scriptable.

The cookies are used in the header of the requests sent to Instagram servers. The user needs to be authorized to access the servers, the cookies help with that.</div></div>
<button class="button gUnknown inside" data-uuid="C45E0E9E-E448-42DD-93F1-11A5742F317B" id="m18">
18 dk.simonbs.Scriptable.RunScriptInlineIntent <b>　➔ User</b>　» <span class="magic" onclick="magictap(20)">20</span> <span class="magic" onclick="magictap(29)">29</span> <span class="magic" onclick="magictap(47)">47</span> <span class="magic" onclick="magictap(49)">49</span></button>
	<div class="content inside">
		<div class="row"><div class="col1">script</div>
			<div class="col2">const r = new Request('https://www.instagram.com/')<b>\u{space}</b>
await r.load()<b>\u{space}</b>
const cookie = r.response.cookies.map((c) => `${c.name}=${c.value}`).join('; ')
const userIsNotLoggedIn =  !cookie.includes('sessionid') ? true : false
return { cookie, userIsNotLoggedIn }<b>\u{space}</b>
​</div></div>
		<div class="row"><div class="col1">Show-texts</div>
			<div class="col2">false</div></div>
		<div class="row"><div class="col1">Show-urls</div>
			<div class="col2">false</div></div>
		<div class="row"><div class="col1">urls</div>
			<div class="col2">[]</div></div>
		<div class="row"><div class="col1">runInApp</div>
			<div class="col2">false</div></div>
		<div class="row"><div class="col1">ShowWhenRun</div>
			<div class="col2">false</div></div></div>
<button class="button gYellow inside" id="m19">
19 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Check if the user is not logged in, prompt the user to sign in if that’s true.</div></div>
<button class="gOrange inside" data-uuid="336509E8-22C9-45CC-AF5A-78B3DD2965AD" id="m20">
20 Get Dictionary Value for <span class="box">userIsNotLoggedIn</span> in <span class="box"><span class="magic" onclick="magictap(18)"><b>[18 User</b> as Dictionary<b>]</b></span></span> <b>　➔ User is not logged in</b>　»</button>
<hr><button class="button gGray nonbottom inside" data-uuid="3D92DACC-1EA9-40D6-81B8-3E27AF36B959" id="m21">
21 If <span class="box"><span class="var"><b>[20 User is not logged in</b> as Boolean<b>]</b></span></span> is true</button>
	<div class="content contentloop dashed inside">
<button class="button gYellow inside" id="m22">
22 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">If the user is not logged in, the user has to log in and run MediaDL again.</div></div>
<button class="gYellow inside" id="m23">
23 Show Alert <span class="box">You're not logged in to Instagram. Do you want to log in now?</span></button>
<button class="button gUnknown inside" data-uuid="9741D9CF-639A-4200-A710-6EAF27149CDA" id="m24">
24 dk.simonbs.Scriptable.RunScriptInlineIntent</button>
	<div class="content inside">
		<div class="row"><div class="col1">script</div>
			<div class="col2">WebView.loadURL('https://www.instagram.com/')<b>\u{space}</b>
// add notification to run MediaDL again<b>\u{space}</b></div></div>
		<div class="row"><div class="col1">runInApp</div>
			<div class="col2">true</div></div>
		<div class="row"><div class="col1">ShowWhenRun</div>
			<div class="col2">false</div></div></div>
<button class="button gYellow inside" id="m25">
25 Show Alert <span class="box">Log in and tap Close. Then share the post to MediaDL again</span></button>
	<div class="content inside">
		<div class="row"><div class="col1">AlertActionCancelButtonShown</div>
			<div class="col2">false</div></div></div>
<button class="gGray inside" id="m26">
26 Stop This Shortcut</button></div>
<button class="gGray nontop inside" data-uuid="D3A25E4E-19B3-4ADE-8DDA-3C4D335C7A1D" id="m27">
27 End If　▵<span class="magic" onclick="magictap(21)">21</span></button>
<button class="button gYellow inside" id="m28">
28 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">If the user is logged in, carry on to retrieve download links.

Using cookie information from Scriptable, load the webpage of the Instagram post.</div></div>
<button class="button gGreen inside" data-uuid="BA8AB34B-8E85-489D-8550-7907DC3C5816" id="m29">
29 Get Contents of URL <span class="box"><span class="var"><b>[Shortcut Input]</b></span></span>　»</button>
	<div class="content inside">
		<div class="row"><div class="col1">HTTPHeaders</div>
			<div class="col2">{  "cookie": "<span class="magic" onclick="magictap(18)"><b>[18 User</b> as Dictionary.cookie<b>]</b></span>" }</div></div>
		<div class="row"><div class="col1">ShowHeaders</div>
			<div class="col2">false</div></div></div>
<hr><button class="button gBlue inside" data-uuid="7CE64A13-5996-47E0-AE45-E42E59996CDA" id="m30">
30 Make HTML from Rich Text <span class="box"><span class="var"><b>[29 Contents of URL</b> as RichText<b>]</b></span></span>　» <span class="magic" onclick="magictap(33)">33</span> <span class="magic" onclick="magictap(35)">35</span></button>
	<div class="content inside">
		<div class="row"><div class="col1">MakeFullDocument</div>
			<div class="col2">false</div></div></div>
<button class="button gYellow inside" id="m31">
31 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Depending on whether it is a story or a post, retrieve its reel or media ID respectively.

This is what is used to get the download URLs for the raw files.</div></div>
<button class="button gGray nonbottom inside" data-uuid="6A9C0F34-240E-4BB9-8790-2BB840004CB3" id="m32">
32 If <span class="box"><span class="var"><b>[Shortcut Input]</b></span></span> <span class="box">contains</span> <span class="box">/stories/</span></button>
	<div class="content contentloop dashed inside">
<button class="gYellow inside" data-uuid="56F29CD8-7459-4E76-A1F6-92E3EAE571CE" id="m33">
33 Match Text <span class="box">(?&lt;="id":")[0-9]*(?=")</span> in <span class="box"><span class="magic" onclick="magictap(30)"><b>[30 HTML from Rich Text]</b></span></span> <b>　➔ Match IG Reel IDs</b></button></div>
<button class="button gGray nonbottom nontop inside" data-uuid="0A878E6B-3DCD-428E-A94E-912D58F421D7" id="m34">
34 Otherwise</button>
	<div class="content contentloop dashed inside">
<button class="gYellow inside" data-uuid="AA606021-B6D3-463B-87E5-2EAFD8B1F75F" id="m35">
35 Match Text <span class="box">((?&lt;=media\?id=)[0-9]*(?="))|((?&lt;="media_id":")[0-9]*(?="))</span> in <span class="box"><span class="magic" onclick="magictap(30)"><b>[30 HTML from Rich Text]</b></span></span> <b>　➔ Match IG Media IDs</b></button></div>
<button class="gGray nontop inside" data-uuid="FC618B60-4944-441C-B4FB-A65100C31A7C" id="m36">
36 End If <b>　➔ Matched Reel or Media ID</b>　» <span class="magic" onclick="magictap(38)">38</span> <span class="magic" onclick="magictap(44)">44</span></button>
<button class="button gYellow inside" id="m37">
37 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Check if the reel or media ID was extracted successfully.</div></div>
<button class="button gGray nonbottom inside" data-uuid="9413DEB4-0409-44FB-9DBC-D4BAE984642C" id="m38">
38 If <span class="box"><span class="magic" onclick="magictap(36)"><b>[36 Matched Reel or Media ID]</b></span></span> <span class="box">does not have any value</span></button>
	<div class="content contentloop dashed inside">
<button class="button gYellow inside" id="m39">
39 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">If there is no matched reel or media ID, just show an error message, then quit.

RMI - missing reel or media ID.

This has occurred before, it was really hard to pinpoint the cause of failure to this.</div></div>
<button class="button gYellow inside" id="m40">
40 Show Alert <span class="box">An error occurred: RMI</span></button>
	<div class="content inside">
		<div class="row"><div class="col1">AlertActionCancelButtonShown</div>
			<div class="col2">false</div></div></div>
<button class="gGray inside" id="m41">
41 Stop This Shortcut</button></div>
<button class="gGray nontop inside" data-uuid="75E87125-0F26-4256-87E8-083170C0DD84" id="m42">
42 End If</button>
<button class="button gYellow inside" id="m43">
43 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">If the Reel or Media ID was extracted successfully, fetch the JSON information about the post.</div></div>
<button class="gOrange inside" data-uuid="325C01CF-9A47-48A4-9BDB-9127ECFFFFEE" id="m44">
44 Get First Item from List <span class="box"><span class="magic" onclick="magictap(36)"><b>[36 Matched Reel or Media ID]</b></span></span> <b>　➔ media-or-reel-id</b>　» <span class="magic" onclick="magictap(47)">47</span> <span class="magic" onclick="magictap(49)">49</span></button>
<button class="button gYellow inside" id="m45">
45 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">The API endpoints for fetching the JSON information for stories and posts are different, so check and act accordingly.

Additional headers are attached to the request to allow Instagram servers fullfill the request.</div></div>
<button class="button gGray nonbottom inside" data-uuid="7957D375-81A7-4AD9-ADCE-AF5F699B3C83" id="m46">
46 If <span class="box"><span class="var"><b>[Shortcut Input]</b></span></span> <span class="box">contains</span> <span class="box">/stories/</span></button>
	<div class="content contentloop dashed inside">
<button class="button gGreen inside" data-uuid="AF8E0DC8-0A20-4BDD-9CB7-6F7CD106AB8B" id="m47">
47 Get Contents of URL <span class="box">https://i.instagram.com/api/v1/feed/reels_media/?reel_ids=<span class="magic" onclick="magictap(44)"><b>[44 media-or-reel-id]</b></span></span></button>
	<div class="content inside">
		<div class="row"><div class="col1">HTTPHeaders</div>
			<div class="col2">{  "cookie": "<span class="magic" onclick="magictap(18)"><b>[18 User</b> as Dictionary.cookie<b>]</b></span>",
   "x-ig-app-id": "936619743392459"
}</div></div>
		<div class="row"><div class="col1">ShowHeaders</div>
			<div class="col2">true</div></div></div></div>
<button class="button gGray nonbottom nontop inside" data-uuid="6D45B093-A524-440B-973C-034B724783DC" id="m48">
48 Otherwise</button>
	<div class="content contentloop dashed inside">
<button class="button gGreen inside" data-uuid="E17FC213-2CC3-4A98-934C-133295F49104" id="m49">
49 Get Contents of URL <span class="box">https://i.instagram.com/api/v1/media/<span class="magic" onclick="magictap(44)"><b>[44 media-or-reel-id]</b></span>/info/</span></button>
	<div class="content inside">
		<div class="row"><div class="col1">HTTPHeaders</div>
			<div class="col2">{  "cookie": "<span class="magic" onclick="magictap(18)"><b>[18 User</b> as Dictionary.cookie<b>]</b></span>",
   "x-ig-app-id": "936619743392459"
}</div></div>
		<div class="row"><div class="col1">ShowHeaders</div>
			<div class="col2">false</div></div></div></div>
<button class="gGray nontop inside" data-uuid="47C18C25-26DE-4B67-B38E-5668A0A8AE33" id="m50">
50 End If <b>　➔ Instagram API endpoint JSON</b>　» <span class="magic" onclick="magictap(52)">52</span> <span class="magic" onclick="magictap(61)">61</span> <span class="magic" onclick="magictap(62)">62</span> <span class="magic" onclick="magictap(69)">69</span> <span class="magic" onclick="magictap(72)">72</span> <span class="magic" onclick="magictap(75)">75</span> <span class="magic" onclick="magictap(81)">81</span> <span class="magic" onclick="magictap(82)">82</span></button>
<button class="button gYellow inside" id="m51">
51 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Now that a JSON response is returned, check if it is ok.</div></div>
<button class="gOrange inside" data-uuid="88B44FC3-4B52-4405-B5B6-79902F13D597" id="m52">
52 Get Dictionary Value for <span class="box">status</span> in <span class="box"><span class="magic" onclick="magictap(50)"><b>[50 Instagram API endpoint JSON]</b></span></span> <b>　➔ status</b>　»</button>
<hr><button class="button gGray nonbottom inside" data-uuid="1A3BEAE5-03A2-4EE3-BEF7-7865838DEC93" id="m53">
53 If <span class="box"><span class="var"><b>[52 status</b> as RichText<b>]</b></span></span> <span class="box">does not contain</span> <span class="box">ok</span></button>
	<div class="content contentloop dashed inside">
<button class="button gYellow inside" id="m54">
54 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">If the “status” JSON field is not “ok”, nothing can be done on this end.

Show an error message and quit.

IAS - Instagram API JSON status is not ok.</div></div>
<button class="button gYellow inside" id="m55">
55 Show Alert <span class="box">An Error occurred: IAS</span></button>
	<div class="content inside">
		<div class="row"><div class="col1">AlertActionCancelButtonShown</div>
			<div class="col2">false</div></div></div>
<button class="gGray inside" id="m56">
56 Stop This Shortcut</button></div>
<button class="gGray nontop inside" data-uuid="3E78B323-8A10-4011-93C4-8076D6E687BE" id="m57">
57 End If</button>
<button class="button gYellow inside" id="m58">
58 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Now that we have confirmed that the JSON status is ok, we can begin collecting the information we need.

Right now, we need the:

- author’s username:- We are using this to rename the file(s). Author is the account that uploaded the story or post the user is attempting to download.

- media information (as a list of dictionaries):- Information about the image(s) and/or video(s) in the story or post. This contains the URL(s) we need. This list is ordered from left to right just the way we see the story or post online.

- media types (as a list of numbers):- Instagram structures the JSON differently depending on the type of media, we will use this list as a helper to correctly collect data from the media information list. This list is ordered same way as the media information list. It is also put together from looping through the media information list.<b>\u{space}</b>

Instagram media type can be:
- image [1]
- video [2]
- carousel [8]

We will use the media type to determine which field in the media information dictionary, the download URL is.

This JSON structure may change in the future as Instagram update their APIs.</div></div>
<button class="button gGray nonbottom inside" data-uuid="B8CDECF2-B972-4E51-B561-D95AE930F3FF" id="m59">
59 If <span class="box"><span class="var"><b>[Shortcut Input]</b></span></span> <span class="box">contains</span> <span class="box">/stories/</span></button>
	<div class="content contentloop dashed inside">
<button class="button gYellow inside" id="m60">
60 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">If it’s a story, collect the:
- story author’s username
- story media info
- story media types

A story media can be of type:
- image [1]
- video [2]</div></div>
<button class="gOrange inside" id="m61">
61 Set Variable <span class="box">Username of Post Author</span> to <span class="box"><span class="magic" onclick="magictap(50)"><b>[50 Instagram API endpoint JSON</b> as Dictionary.reels_media.1.user.username<b>]</b></span></span></button>
<button class="gOrange inside" id="m62">
62 Set Variable <span class="box">IG Media Items Info</span> to <span class="box"><span class="magic" onclick="magictap(50)"><b>[50 Instagram API endpoint JSON</b> as Dictionary.reels_media.1.items<b>]</b></span></span></button>
<button class="button gYellow inside" id="m63">
63 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Loop through the media information and retrieve each media type.</div></div>
<button class="button gGray nonbottom inside" data-uuid="6CA7C024-C7E6-4A07-A929-F74D9A1B7353" id="m64">
64 Repeat with Each in <span class="box"><span class="var"><b>[IG Media Items Info]</b></span></span></button>
	<div class="content contentloop inside">
<button class="gOrange inside" id="m65">
65 Add <span class="box"><span class="var"><b>[Repeat Item</b> as Dictionary.media_type<b>]</b></span></span> to Variable <span class="box">IG Media Types</span></button></div>
<button class="gGray nontop inside" id="m66">
66 End Repeat with Each</button></div>
<button class="button gGray nonbottom nontop inside" data-uuid="EFC8B112-C713-4694-88C2-7739D04279A9" id="m67">
67 Otherwise　▵<span class="magic" onclick="magictap(59)">59</span></button>
	<div class="content contentloop dashed inside">
<button class="button gYellow inside" id="m68">
68 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">If it’s not a story, then it’s a post. Collect the:
- post author’s username
- post media info
- post media types

A post media can be of type:
- image [1]
- video [2]
- carousel [8]</div></div>
<button class="gOrange inside" id="m69">
69 Set Variable <span class="box">Username of Post Author</span> to <span class="box"><span class="magic" onclick="magictap(50)"><b>[50 Instagram API endpoint JSON</b> as Dictionary.items.1.user.username<b>]</b></span></span></button>
<button class="button gYellow inside" id="m70">
70 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">The end result of this block needs a list of images and videos. We need to check if it is a carousel and retrieve the media information of its slides.</div></div>
<button class="button gYellow inside" id="m71">
71 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Remember that you need to pipe dictionary values through a Dictionary to use it properly in an “if” action.</div></div>
<button class="gOrange inside" data-uuid="E4519E63-9FDA-42F9-8959-3E19C6325C20" id="m72">
72 Get Dictionary Value for <span class="box">items.1.media_type</span> in <span class="box"><span class="magic" onclick="magictap(50)"><b>[50 Instagram API endpoint JSON]</b></span></span> <b>　➔ Media Type</b>　»</button>
<hr><button class="button gGray nonbottom inside" data-uuid="1444CD8F-6793-4EA5-8698-0D611A9B78FC" id="m73">
73 If <span class="box"><span class="var"><b>[72 Media Type</b> as RichText<b>]</b></span></span> <span class="box">contains</span> <span class="box">8</span></button>
	<div class="content contentloop inside">
<button class="button gYellow inside" id="m74">
74 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">If it is a carousel, save its media information, loop through the media information and retrieve each media type.</div></div>
<button class="gOrange inside" id="m75">
75 Set Variable <span class="box">IG Media Items Info</span> to <span class="box"><span class="magic" onclick="magictap(50)"><b>[50 Instagram API endpoint JSON</b> as Dictionary.items.1.carousel_media<b>]</b></span></span></button>
<button class="button gGray nonbottom inside" data-uuid="CE1DBB4B-995C-4065-BA78-AE9E52DB2830" id="m76">
76 Repeat with Each in <span class="box"><span class="var"><b>[IG Media Items Info]</b></span></span></button>
	<div class="content contentloop dashed inside">
<button class="gOrange inside" id="m77">
77 Add <span class="box"><span class="var"><b>[Repeat Item</b> as Dictionary.media_type<b>]</b></span></span> to Variable <span class="box">IG Media Types</span></button></div>
<button class="gGray nontop inside" id="m78">
78 End Repeat with Each</button></div>
<button class="button gGray nonbottom nontop inside" data-uuid="FD59456C-CA08-4CF5-B83C-D5002B45CADA" id="m79">
79 Otherwise　▵<span class="magic" onclick="magictap(73)">73</span></button>
	<div class="content contentloop inside">
<button class="button gYellow inside" id="m80">
80 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">If it is not a carousel, then it is a single post of one image or a reel.

Save the media info and the media type.

They will be used in the next block.</div></div>
<button class="gOrange inside" id="m81">
81 Set Variable <span class="box">IG Media Items Info</span> to <span class="box"><span class="magic" onclick="magictap(50)"><b>[50 Instagram API endpoint JSON</b> as Dictionary.items<b>]</b></span></span></button>
<button class="gOrange inside" id="m82">
82 Set Variable <span class="box">IG Media Types</span> to <span class="box"><span class="magic" onclick="magictap(50)"><b>[50 Instagram API endpoint JSON</b> as Dictionary.items.1.media_type<b>]</b></span></span></button></div>
<button class="gGray nontop inside" id="m83">
83 End If</button></div>
<button class="gGray nontop inside" data-uuid="BC653C3D-C941-4220-9A41-B6F2B6C763F0" id="m84">
84 End If　▵<span class="magic" onclick="magictap(67)">67</span></button>
<button class="button gYellow inside" id="m85">
85 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Now that we have gotten the:
- author’s username
- media information (as a list of dictionaries)
- media types (as a list of numbers)

We can confidently extract the download URLs and save to Photos.

We are by default, choosing the highest quality available.</div></div>
<button class="button gGray nonbottom inside" data-uuid="6D51EF8B-47E4-404E-B015-CAA19D06F707" id="m86">
86 Repeat with Each in <span class="box"><span class="var"><b>[IG Media Types]</b></span></span></button>
	<div class="content contentloop dashed inside">
<button class="button gYellow inside" id="m87">
87 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">The media information and media types lists are side by side. So, at each index we can use the media type to determine which field the raw file URL is, in the media information list.</div></div>
<button class="gOrange inside" data-uuid="C3367420-61B8-4194-A397-D16EFAB3FE80" id="m88">
88 Get <span class="box">Item At Index</span> <span class="box"><span class="var"><b>[Repeat Index]</b></span></span> from List <span class="box"><span class="var"><b>[IG Media Items Info]</b></span></span> <b>　➔ Current Media Item Info</b>　» <span class="magic" onclick="magictap(92)">92</span> <span class="magic" onclick="magictap(96)">96</span></button>
<button class="button gYellow inside" id="m89">
89 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Now that we have a media type and its corresponding info, check if the media is an image or a video and retrieve its download URL correctly.</div></div>
<button class="button gGray nonbottom inside" data-uuid="71647912-B0C8-44AD-A8C6-367694595BB7" id="m90">
90 If <span class="box"><span class="var"><b>[Repeat Item</b> as RichText<b>]</b></span></span> <span class="box">contains</span> <span class="box">1</span></button>
	<div class="content contentloop inside">
<button class="button gYellow inside" id="m91">
91 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">If it is an image [1], set the download URL.</div></div>
<button class="gOrange inside" id="m92">
92 Add <span class="box"><span class="magic" onclick="magictap(88)"><b>[88 Current Media Item Info</b> as Dictionary.image_versions2.candidates.1.url<b>]</b></span></span> to Variable <span class="box">Download Urls</span></button></div>
<button class="gGray nontop inside" id="m93">
93 End If</button>
<button class="button gGray nonbottom inside" data-uuid="8C5FD40E-94BE-4444-B965-D3F882608867" id="m94">
94 If <span class="box"><span class="var"><b>[Repeat Item</b> as RichText<b>]</b></span></span> <span class="box">contains</span> <span class="box">2</span></button>
	<div class="content contentloop inside">
<button class="button gYellow inside" id="m95">
95 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">If it is a video [2], set the download URL.</div></div>
<button class="gOrange inside" id="m96">
96 Add <span class="box"><span class="magic" onclick="magictap(88)"><b>[88 Current Media Item Info</b> as Dictionary.video_versions.1.url<b>]</b></span></span> to Variable <span class="box">Download Urls</span></button></div>
<button class="gGray nontop inside" id="m97">
97 End If</button></div>
<button class="gGray nontop inside" data-uuid="716D6872-E081-4D87-ACD8-08ADB97B5346" id="m98">
98 End Repeat with Each　▵<span class="magic" onclick="magictap(86)">86</span></button></div>
<button class="gGray nontop" data-uuid="2531A35C-F48F-4FDA-B78A-FBD3B35959D9" id="m99">
99 End If　▵<span class="magic" onclick="magictap(14)">14</span></button>
<button class="button gYellow" id="m100">
100 Comment</button>
	<div class="content commentcontent">
		<div class="col2">After retrieving the URLs for the items to download, check if the list is empty.

If the list is empty, show a message and quit.</div></div>
<button class="button gGray nonbottom" data-uuid="6C0A4E7D-076B-455D-99EC-DEC97782BBBB" id="m101">
101 If <span class="box"><span class="var"><b>[Download Urls]</b></span></span> <span class="box">does not have any value</span></button>
	<div class="content contentloop">
<button class="button gYellow inside" id="m102">
102 Show Alert <span class="box">Could not find download URLs</span></button>
	<div class="content inside">
		<div class="row"><div class="col1">AlertActionCancelButtonShown</div>
			<div class="col2">false</div></div></div>
<button class="gGray inside" id="m103">
103 Stop This Shortcut</button></div>
<button class="gGray nontop" data-uuid="79A883AB-193B-444E-AC44-A82326FEB1EF" id="m104">
104 End If</button>
<button class="button gYellow" id="m105">
105 Comment</button>
	<div class="content commentcontent">
		<div class="col2">If the list is not empty and there are URLs in the download list, attempt to download the files.</div></div>
<button class="" data-uuid="DB4FA99D-3B09-4BF5-8254-C795202BDDF3" id="m106">
106 Count Items in <span class="box"><span class="var"><b>[Download Urls]</b></span></span> <b>　➔ Number of download URLs</b>　» <span class="magic" onclick="magictap(108)">108</span></button>
<button class="button gYellow" id="m107">
107 Comment</button>
	<div class="content commentcontent">
		<div class="col2">We are counting the URLs to improve the UX for the user.

If there’s only one URL, that’s fine, download the file and move on.

But if there are multiple URLs, show a prompt for the user to select the items they want saved.</div></div>
<button class="button gGray nonbottom" data-uuid="455BACDD-2A61-4CBF-BB9E-F2507B3F91CF" id="m108">
108 If <span class="box"><span class="magic" onclick="magictap(106)"><b>[106 Number of download URLs]</b></span></span> <span class="box">is</span> <span class="box">1</span></button>
	<div class="content contentloop">
<button class="button gYellow inside" id="m109">
109 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Download the one file and rename it to something practical.</div></div>
<button class="button gGreen inside" data-uuid="0EFD044E-5B10-431E-9725-2EFD8FB7FFA3" id="m110">
110 Get Contents of URL <span class="box"><span class="var"><b>[Download Urls]</b></span></span>　»</button>
	<div class="content inside">
		<div class="row"><div class="col1">HTTPHeaders</div>
			<div class="col2">{}</div></div>
		<div class="row"><div class="col1">ShowHeaders</div>
			<div class="col2">true</div></div></div>
<hr><button class=" inside" data-uuid="55730A0A-BD67-4211-BDA6-2B6A32BBEDB8" id="m111">
111 Set Name of <span class="box"><span class="var"><b>[110 Contents of URL]</b></span></span> to <span class="box"><span class="var"><b>[Username of Post Author]</b></span> <span class="var"><b>[CurrentDate</b>{"Date Style":"Custom","WFDateFormat":"yyyy_MM_dd HHmmss","WFISO8601IncludeTime":false}<b>]</b></span></span></button></div>
<button class="button gGray nonbottom nontop" data-uuid="A0F1FBA8-602A-465C-B738-BF8F0B0C99B1" id="m112">
112 Otherwise</button>
	<div class="content contentloop">
<button class="button gYellow inside" id="m113">
113 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Loop through the URLs, and download each file. Rename the files also.</div></div>
<button class="button gGray nonbottom inside" data-uuid="2A1EDE82-6192-409D-AD65-3E275DBAADA3" id="m114">
114 Repeat with Each in <span class="box"><span class="var"><b>[Download Urls]</b></span></span></button>
	<div class="content contentloop dashed inside">
<button class="button gGreen inside" data-uuid="0CB57797-9A80-4BFA-A2DE-8139103C4E31" id="m115">
115 Get Contents of URL <span class="box"><span class="var"><b>[Repeat Item]</b></span></span>　»</button>
	<div class="content inside">
		<div class="row"><div class="col1">HTTPHeaders</div>
			<div class="col2">{}</div></div>
		<div class="row"><div class="col1">ShowHeaders</div>
			<div class="col2">false</div></div></div>
<hr><button class=" inside" data-uuid="B66ED5F3-6A78-4010-9C56-8BECFF58BE97" id="m116">
116 Set Name of <span class="box"><span class="var"><b>[115 Contents of URL]</b></span></span> to <span class="box"><span class="var"><b>[Username of Post Author]</b></span> <span class="var"><b>[CurrentDate</b>{"Date Style":"Custom","WFDateFormat":"yyyy_MM_dd HHmmss","WFISO8601IncludeTime":false}<b>]</b></span></span></button></div>
<button class="gGray nontop inside" data-uuid="246B0F70-BE3E-4686-AF45-AE069F8FC19C" id="m117">
117 End Repeat with Each　» <span class="magic" onclick="magictap(119)">119</span></button>
<button class="button gYellow inside" id="m118">
118 Comment</button>
	<div class="content inside commentcontent">
		<div class="col2">Show a prompt for the user to select which files to save.<b>\u{space}</b>

These files here are downloaded already, we need to find a way to show this prompt before downloading the files. So the user doesn’t download unnecessary files.</div></div>
<button class="button gOrange inside" data-uuid="2BA2ED79-20A8-457F-A6C3-30A0F1A01DD7" id="m119">
119 Choose from List <span class="box"><span class="magic" onclick="magictap(117)"><b>[117 Repeat Results]</b></span></span></button>
	<div class="content inside">
		<div class="row"><div class="col1">ChooseFromListActionPrompt</div>
			<div class="col2">Choose files to save</div></div>
		<div class="row"><div class="col1">ChooseFromListActionSelectMultiple</div>
			<div class="col2">true</div></div>
		<div class="row"><div class="col1">ChooseFromListActionSelectAll</div>
			<div class="col2">true</div></div></div></div>
<button class="gGray nontop" data-uuid="B9757ABA-3B55-4BCE-ACAB-F0E58436AE19" id="m120">
120 End If　▵<span class="magic" onclick="magictap(112)">112</span> <b>　➔ Files to be saved</b>　» <span class="magic" onclick="magictap(122)">122</span></button>
<button class="button gYellow" id="m121">
121 Comment</button>
	<div class="content commentcontent">
		<div class="col2">After downloading the file(s) the user wants, save them to the correct album in Photos.</div></div>
<button class="" data-uuid="4D9EBF3F-7FAC-4922-9122-DC3BC75D2B75" id="m122">
122 Create Photo Album <span class="box"><span class="var"><b>[Platform]</b></span></span> with <span class="box"><span class="magic" onclick="magictap(120)"><b>[120 Files to be saved]</b></span></span></button>
<script>
for (b of document.getElementsByClassName('button')) {
	b.addEventListener('click', function() {
		this.classList.toggle('closed');
		let s = this.nextElementSibling;
		s.style.display = getComputedStyle(s).display==='none' ? 'block' : 'none';
})}

function magictap(id) {
	event.stopPropagation();
	let e = document.getElementById('m'+id);
	let p = e;
	while ((p = p.parentNode).tagName.toLowerCase() === 'div') {
		p.style.display = 'block';
		p.previousElementSibling.classList.remove('closed');
	}
	setTimeout(function(){ e.scrollIntoView({block:'nearest',behavior:'smooth'}); }, 10);
}
</script></body></html>